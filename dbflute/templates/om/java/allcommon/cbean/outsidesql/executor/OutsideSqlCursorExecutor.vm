${database.allClassCopyright}package ${glPackageBaseCommonCBeanOutsidesqlExecutor};

import ${glPackageBaseCommon}.${glDBDef};
import ${glPackageBaseCommonBhvCore}.${glBehaviorCommand};
import ${glPackageBaseCommonBhvCore}.${glBehaviorCommandInvoker};
import ${glPackageBaseCommonBhvCoreCommand}.${glOutsideSqlSelectCursorCommand};
import ${glPackageBaseCommonCBeanOutsidesql}.${glOutsideSqlOptionName};
import ${glPackageBaseCommonJdbc}.${glCursorHandlerName};
import ${glPackageBaseCommonJdbc}.${glStatementConfig};

/**
 * The cursor executor of outside-SQL.
 * @param <PARAMETER_BEAN> The type of parameter-bean.
 * @author ${database.ClassAuthor}
 */
public class ${glOutsideSqlCursorExecutorName}<PARAMETER_BEAN> {

    // ===================================================================================
    //                                                                           Attribute
    //                                                                           =========
    /** The invoker of behavior command. (NotNull) */
    protected final ${glBehaviorCommandInvoker} _behaviorCommandInvoker;

    /** The option of outside-SQL. (NotNull) */
    protected final ${glOutsideSqlOptionName} _outsideSqlOption;

    /** The DB name of table. (NotNull) */
    protected final String _tableDbName;

	/** The current database definition. (NotNull) */
    protected ${glDBDef} _currentDBDef;

    // ===================================================================================
    //                                                                         Constructor
    //                                                                         ===========
    public ${glOutsideSqlCursorExecutorName}(${glBehaviorCommandInvoker} behaviorCommandInvoker
                                  , ${glOutsideSqlOptionName} outsideSqlOption
                                  , String tableDbName
                                  , ${glDBDef} currentDBDef) {
        this._behaviorCommandInvoker = behaviorCommandInvoker;
        this._outsideSqlOption = outsideSqlOption;
        this._tableDbName = tableDbName;
        this._currentDBDef = currentDBDef;
    }

    // ===================================================================================
    //                                                                              Select
    //                                                                              ======
    /**
     * Select the cursor of the entity.
     * @param path The path of SQL file. (NotNull)
     * @param pmb The parameter-bean. Allowed types are Bean object and Map object. (Nullable)
     * @param handler The handler of cursor. (NotNull)
     * @return The result object that the cursor handler returns. (Nullable)
     * @exception ${glPackageBaseCommonException}.${glOutsideSqlNotFoundException} When the outside-SQL is not found.
     */
    public Object selectCursor(String path, PARAMETER_BEAN pmb, ${glCursorHandlerName} handler) {
        return invoke(createSelectCursorCommand(path, pmb, handler));
    }

    // ===================================================================================
    //                                                                    Behavior Command
    //                                                                    ================
    protected ${glBehaviorCommand}<Object> createSelectCursorCommand(String path, PARAMETER_BEAN pmb, ${glCursorHandlerName} handler) {
        return xsetupCommand(new ${glOutsideSqlSelectCursorCommand}(), path, pmb, handler);
    }

    private ${glOutsideSqlSelectCursorCommand} xsetupCommand(${glOutsideSqlSelectCursorCommand} command, String path, PARAMETER_BEAN pmb, ${glCursorHandlerName} handler) {
        command.setTableDbName(_tableDbName);
        _behaviorCommandInvoker.injectComponentProperty(command);
        command.setOutsideSqlPath(path);
        command.setParameterBean(pmb);
        command.setOutsideSqlOption(_outsideSqlOption);
        command.setCurrentDBDef(_currentDBDef);
        command.setCursorHandler(handler);
        return command;
    }

    /**
     * Invoke the command of behavior.
     * @param <RESULT> The type of result.
     * @param behaviorCommand The command of behavior. (NotNull)
     * @return The instance of result. (Nullable)
     */
    protected <RESULT> RESULT invoke(${glBehaviorCommand}<RESULT> behaviorCommand) {
        return _behaviorCommandInvoker.invoke(behaviorCommand);
    }

    // ===================================================================================
    //                                                                              Option
    //                                                                              ======
    public ${glOutsideSqlCursorExecutorName}<PARAMETER_BEAN> dynamicBinding() {
        _outsideSqlOption.dynamicBinding();
        return this;
    }

    public ${glOutsideSqlCursorExecutorName}<PARAMETER_BEAN> configure(${glStatementConfig} statementConfig) {
		_outsideSqlOption.setStatementConfig(statementConfig);
        return this;
    }
}
